‚Äå<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PHURAI FINAL MAX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --main: #0084ff; --dark: #000; --panel: #121212; }
        body { background: var(--dark); color: #fff; font-family: sans-serif; height: 100dvh; margin: 0; display: flex; flex-direction: column; overflow: hidden; }
        .header { padding: 15px; background: var(--panel); border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .user-list { display: flex; gap: 12px; overflow-x: auto; padding: 12px; background: var(--panel); border-bottom: 1px solid #222; scrollbar-width: none; }
        .u-card { min-width: 60px; text-align: center; position: relative; cursor: pointer; }
        .u-img { width: 52px; height: 52px; border-radius: 50%; border: 2px solid var(--main); object-fit: cover; margin: 0 auto; }
        .u-dot { position: absolute; bottom: 20px; right: 6px; width: 14px; height: 14px; background: #22c55e; border: 2px solid #121212; border-radius: 50%; display: none; }
        .online .u-dot { display: block; }
        .chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; padding-bottom: 110px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 20px; font-size: 15px; cursor: pointer; position: relative; }
        .sent { background: var(--main); align-self: flex-end; border-bottom-right-radius: 4px; }
        .recv { background: #262629; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #333; }
        .msg img { border-radius: 10px; max-width: 100%; margin-top: 5px; }
        
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶æ‡¶≤ ‡¶¶‡¶æ‡¶ó‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶á‡¶®‡¶™‡ßÅ‡¶ü */
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 10px 15px calc(25px + env(safe-area-inset-bottom)); border-top: 1px solid #222; z-index: 100; }
        .input-grp { display: flex; align-items: center; gap: 10px; background: #1c1c1e; border-radius: 30px; padding: 5px 12px; border: 1px solid #333; }
        .typing { color: #22c55e; font-size: 10px; margin-left: 15px; position: absolute; bottom: 85px; display: none; }
        #login { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 25px; }
    </style>
</head>
<body>
    <div id="login">
        <h1 class="text-4xl font-black mb-6 text-blue-500 italic">PHURAI MAX</h1>
        <input type="file" id="pInp" accept="image/*" class="hidden" onchange="preview(this)">
        <label for="pInp" class="w-20 h-20 bg-gray-900 rounded-full mb-4 flex items-center justify-center overflow-hidden border-2 border-dashed border-blue-500">
            <img id="pPre" class="hidden w-full h-full object-cover">
            <span id="pPlus" class="text-3xl text-blue-500">+</span>
        </label>
        <input id="lPh" type="tel" placeholder="‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="w-full max-w-xs bg-[#111] p-4 rounded-xl mb-4 border border-gray-700 text-center text-white outline-none">
        <input id="lNm" type="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="w-full max-w-xs bg-[#111] p-4 rounded-xl mb-6 border border-gray-700 text-center text-white outline-none">
        <button onclick="login()" class="w-full max-w-xs bg-blue-600 p-4 rounded-xl font-bold text-lg">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div class="header">
        <div>
            <h2 id="tNm" class="text-lg font-black text-blue-500">PHURAI</h2>
            <p id="tSt" class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>
        <button onclick="localStorage.clear(); location.reload();" class="text-[10px] border border-gray-700 px-2 py-1 rounded text-gray-500">Log out</button>
    </div>

    <div id="uList" class="user-list"></div>
    <div id="cBox" class="chat-box" onclick="document.getElementById('mIn').focus()"></div>
    <div id="typ" class="typing">‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶õ‡ßá...</div>

    <div class="footer">
        <div class="input-grp">
            <label for="imgInp" class="cursor-pointer text-xl">üñºÔ∏è</label>
            <input type="file" id="imgInp" accept="image/*" class="hidden" onchange="sendImg(this)">
            <input id="mIn" type="text" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="flex-1 bg-transparent border-none outline-none text-white h-10" oninput="isTyping()">
            <button onclick="send()" class="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center active:scale-90 transition">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
            </button>
        </div>
    </div>

    <script>
        const conf = { apiKey: "AIzaSyAo-AtxN0eLgtN-HznpTq2c", authDomain: "phurai-3a289.firebaseapp.com", projectId: "phurai-3a289", storageBucket: "phurai-3a289.appspot.com", messagingSenderId: "841766177401", appId: "1:841766177401:web:8f41f0ddf9" };
        firebase.initializeApp(conf);
        const db = firebase.firestore();
        let myPh = localStorage.getItem("uPh"), myImg = "";

        if(myPh) { document.getElementById('login').style.display='none'; setOn(true); loadU(); }

        function preview(i) {
            const r = new FileReader();
            r.onload = e => { 
                myImg = e.target.result; 
                document.getElementById('pPre').src = myImg;
                document.getElementById('pPre').classList.remove('hidden');
                document.getElementById('pPlus').style.display='none';
            };
            r.readAsDataURL(i.files[0]);
        }

        function setOn(s) { if(myPh) db.collection("users").doc(myPh).update({ online: s, typing: false }); }
        window.onbeforeunload = () => setOn(false);

        function login() {
            const ph = document.getElementById('lPh').value.trim();
            const nm = document.getElementById('lNm').value.trim();
            if(ph && nm) {
                db.collection("users").doc(ph).set({ phone: ph, name: nm, img: myImg, online: true });
                localStorage.setItem("uPh", ph);
                location.reload();
            }
        }

        function loadU() {
            db.collection("users").onSnapshot(s => {
                const l = document.getElementById('uList'); l.innerHTML = "";
                s.forEach(d => {
                    const u = d.data();
                    if(u.phone !== myPh) {
                        l.innerHTML += `<div class="u-card ${u.online?'online':''}" onclick="start('${u.phone}','${u.name}')">
                            <img src="${u.img||'https://via.placeholder.com/50'}" class="u-img">
                            <div class="u-dot"></div>
                            <p class="text-[9px] mt-1 truncate font-bold">${u.name}</p>
                        </div>`;
                    }
                });
            });
        }

        let cID = "", fPh = "";
        function start(p, n) { 
            fPh = p; cID = [myPh, p].sort().join("_"); 
            document.getElementById('tNm').innerText = n;
            document.getElementById('tSt').innerText = "‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®";
            loadM(); checkTyp();
        }

        function isTyping() { if(myPh) db.collection("users").doc(myPh).update({ typing: true }); setTimeout(()=> db.collection("users").doc(myPh).update({ typing: false }), 2000); }
        function checkTyp() { db.collection("users").doc(fPh).onSnapshot(d => { document.getElementById('typ').style.display = d.data()?.typing ? "block" : "none"; }); }

        function send() {
            const i = document.getElementById('mIn');
            if(!i.value.trim() || !cID) return;
            db.collection("msgs").add({ room: cID, sender: myPh, text: i.value, type: 'text', time: firebase.firestore.FieldValue.serverTimestamp() });
            i.value = "";
        }

        function sendImg(input) {
            if (input.files && input.files[0]) {
                const r = new FileReader();
                r.onload = e => {
                    db.collection("msgs").add({ room: cID, sender: myPh, img: e.target.result, type: 'img', time: firebase.firestore.FieldValue.serverTimestamp() });
                };
                r.readAsDataURL(input.files[0]);
            }
        }

        function loadM() {
            const b = document.getElementById('cBox');
            db.collection("msgs").where("room", "==", cID).orderBy("time", "asc").onSnapshot(s => {
                b.innerHTML = "";
                s.forEach(d => {
                    const m = d.data();
                    const isMe = m.sender === myPh;
                    const div = document.createElement('div');
                    div.className = `msg ${isMe ? 'sent' : 'recv'}`;
                    if(m.type === 'img') { div.innerHTML = `<img src="${m.img}">`; }
                    else { div.innerText = m.text; }
                    div.onclick = () => { if(isMe && confirm("‡¶è‡¶á ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) d.ref.delete(); };
                    b.appendChild(div);
                });
                b.scrollTop = b.scrollHeight;
            });
        }
        document.getElementById('mIn').onkeypress = e => { if(e.key === 'Enter') send(); };
    </script>
</body>
</html>
