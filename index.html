
            // মেসেজ লোড করার এই অংশটুকু পরিবর্তন করা হয়েছে যাতে ইনডেক্স এরর না আসে
        function loadMessages() {
            if(currentSub) currentSub();
            const box = document.getElementById('chat-box');
            currentSub = db.collection("private_messages")
                .where("room", "==", chatID)
                .onSnapshot(snap => {
                    let messages = [];
                    snap.forEach(doc => {
                        messages.push(doc.data());
                    });
                    
                    // সময় অনুযায়ী মেসেজ সাজানো (ইনডেক্স ছাড়া)
                    messages.sort((a, b) => (a.time?.seconds || 0) - (b.time?.seconds || 0));
                    
                    box.innerHTML = "";
                    messages.forEach(d => {
                        const isMe = d.sender === myPhone;
                        box.innerHTML += `<div class="msg ${isMe ? 'sent' : 'received'}">${d.text}</div>`;
                    });
                    box.scrollTop = box.scrollHeight;
                });
        }

