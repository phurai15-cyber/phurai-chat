<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PHURAI NAME EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --bg: #000000; --panel: #121212; --primary: #0084ff; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; height: 100dvh; margin: 0; display: flex; flex-direction: column; overflow: hidden; }
        .header { padding: 12px 16px; background: rgba(18, 18, 18, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #222; }
        .user-list { display: flex; gap: 14px; overflow-x: auto; padding: 12px; background: var(--panel); border-bottom: 1px solid #222; scrollbar-width: none; }
        .user-avatar-wrapper { flex-shrink: 0; text-align: center; width: 65px; cursor: pointer; }
        .user-avatar { width: 50px; height: 50px; background: linear-gradient(135deg, #0084ff, #00c6ff); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #333; margin: 0 auto; font-weight: bold; font-size: 18px; }
        .chat-container { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; background: #000; padding-bottom: 100px; }
        .msg { max-width: 75%; padding: 10px 14px; border-radius: 18px; font-size: 15px; position: relative; }
        .sent { background: var(--primary); align-self: flex-end; border-bottom-right-radius: 4px; }
        .received { background: #262629; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #333; }
        .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #121212; padding: 10px 10px calc(15px + env(safe-area-inset-bottom)); border-top: 1px solid #222; }
        .input-box { display: flex; align-items: center; gap: 10px; background: #1c1c1e; border-radius: 30px; padding: 4px 12px; max-width: 500px; margin: 0 auto; }
        .msg-input { flex: 1; background: transparent; border: none; outline: none; color: white; height: 42px; font-size: 16px; }
        #login-overlay { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
    </style>
</head>
<body>
    <div id="login-overlay">
        <h1 class="text-3xl font-black mb-6 text-blue-500">PHURAI CHAT</h1>
        <input id="phoneInput" type="tel" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" class="w-full max-w-xs bg-[#121212] p-4 rounded-xl border border-gray-800 text-center mb-4 text-white outline-none">
        <input id="nameInput" type="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶´‡¶∞‡¶ø‡¶¶)" class="w-full max-w-xs bg-[#121212] p-4 rounded-xl border border-gray-800 text-center mb-6 text-white outline-none">
        <button onclick="saveLogin()" class="w-full max-w-xs bg-blue-600 p-4 rounded-xl font-bold text-lg">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div class="header flex justify-between items-center">
        <div>
            <h2 class="text-lg font-black text-blue-500">PHURAI</h2>
            <div id="chatting-with-name" class="text-sm font-bold text-white">‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</div>
        </div>
        <button onclick="localStorage.clear(); location.reload();" class="text-[10px] text-gray-500">LOGOUT</button>
    </div>
    
    <div id="user-list" class="user-list"></div>
    <div id="chat-box" class="chat-container"></div>

    <div class="bottom-bar">
        <div class="input-box">
            <input id="msgInput" type="text" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="msg-input" autocomplete="off">
            <button onclick="sendMsg()" class="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
            </button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAo-AtxN0eLgtN-HznpTq2c",
            authDomain: "phurai-3a289.firebaseapp.com",
            projectId: "phurai-3a289",
            storageBucket: "phurai-3a289.appspot.com",
            messagingSenderId: "841766177401",
            appId: "1:841766177401:web:8f41f0ddf9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let myPhone = localStorage.getItem("userPhone");
        if(myPhone) { document.getElementById('login-overlay').style.display = 'none'; loadUsers(); }

        function saveLogin() {
            const phone = document.getElementById('phoneInput').value.trim();
            const name = document.getElementById('nameInput').value.trim();
            if(phone.length >= 10 && name.length > 0) {
                db.collection("users").doc(phone).set({ phone: phone, name: name });
                localStorage.setItem("userPhone", phone);
                myPhone = phone;
                document.getElementById('login-overlay').style.display = 'none';
                loadUsers();
            } else { alert("‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶®‡¶æ‡¶Æ ‡¶¶‡ßÅ‡¶ü‡ßã‡¶á ‡¶¶‡¶ø‡¶®!"); }
        }

        function loadUsers() {
            db.collection("users").onSnapshot(snap => {
                const list = document.getElementById('user-list');
                list.innerHTML = "";
                snap.forEach(doc => {
                    const u = doc.data();
                    if(u.phone !== myPhone) {
                        list.innerHTML += `
                        <div class="user-avatar-wrapper" onclick="startChat('${u.phone}', '${u.name}')">
                            <div class="user-avatar">${u.name.charAt(0).toUpperCase()}</div>
                            <div class="text-[10px] text-gray-300 mt-1 truncate">${u.name}</div>
                        </div>`;
                    }
                });
            });
        }

        let chatID = "";
        function startChat(friendPhone, friendName) {
            chatID = [myPhone, friendPhone].sort().join("_");
            document.getElementById('chatting-with-name').innerText = "üë§ " + friendName;
            loadMessages();
        }

        function sendMsg() {
            const input = document.getElementById('msgInput');
            if(!input.value.trim() || !chatID) return;
            db.collection("private_messages").add({ 
                room: chatID, sender: myPhone, text: input.value, time: firebase.firestore.FieldValue.serverTimestamp() 
            });
            input.value = "";
        }

        function loadMessages() {
            const box = document.getElementById('chat-box');
            db.collection("private_messages").where("room", "==", chatID).orderBy("time", "asc").onSnapshot(snap => {
                box.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    box.innerHTML += `<div class="msg ${d.sender === myPhone ? 'sent' : 'received'}">${d.text}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }
    </script>
</body>
</html>
