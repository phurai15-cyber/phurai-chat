<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phurai Pro - Users List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --bg: #0b0b0d; --panel: #1c1c1e; --primary: #0084ff; --text: #ffffff; }
        body { background: #000; color: var(--text); font-family: sans-serif; height: 100vh; margin: 0; display: flex; justify-content: center; overflow: hidden; }
        .app-window { width: 100%; max-width: 450px; height: 100%; background: var(--bg); display: flex; flex-direction: column; position: relative; border-left: 1px solid #222; border-right: 1px solid #222; }
        #login-overlay { position: absolute; inset: 0; background: var(--bg); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .user-list { display: flex; gap: 10px; overflow-x: auto; padding: 10px; background: #18181b; border-bottom: 1px solid #333; }
        .user-card { min-width: 60px; text-align: center; cursor: pointer; }
        .user-avatar { width: 45px; height: 45px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 5px; border: 2px solid #0084ff; font-weight: bold; font-size: 12px; }
        .chat-container { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .msg { max-width: 75%; padding: 10px 14px; border-radius: 20px; font-size: 15px; }
        .sent { background: var(--primary); align-self: flex-end; border-bottom-right-radius: 4px; }
        .received { background: var(--panel); align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #333; }
        .bottom-bar { padding: 10px 15px 25px 15px; background: var(--bg); border-top: 1px solid #222; }
        .input-box { display: flex; align-items: center; gap: 10px; background: #262629; border-radius: 25px; padding: 5px 5px 5px 15px; }
        .msg-input { flex: 1; background: transparent; border: none; outline: none; color: white; padding: 10px 0; }
    </style>
</head>
<body>
    <div class="app-window">
        <div id="login-overlay">
            <h1 class="text-3xl font-bold text-blue-500 mb-2">PHURAI PRO</h1>
            <p class="text-gray-400 mb-8 text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®</p>
            <input id="phoneInput" type="tel" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" class="w-full bg-[#1c1c1e] p-4 rounded-xl border border-gray-700 text-center mb-4 text-white">
            <button onclick="saveLogin()" class="w-full bg-blue-600 p-4 rounded-xl font-bold text-lg">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
        <div class="p-4 bg-[#18181b] flex justify-between items-center">
            <h2 class="text-lg font-bold text-blue-500">PHURAI PRO</h2>
            <p id="chatting-with" class="text-[10px] text-yellow-500">‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>
        <div id="user-list" class="user-list"></div>
        <div id="chat-box" class="chat-container"></div>
        <div class="bottom-bar">
            <div class="input-box">
                <input id="msgInput" type="text" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="msg-input" autocomplete="off">
                <button onclick="sendMsg()" class="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                </button>
            </div>
        </div>
    </div>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAo-AtxN0eLgtN-HznpTq2c",
            authDomain: "phurai-3a289.firebaseapp.com",
            projectId: "phurai-3a289",
            storageBucket: "phurai-3a289.appspot.com",
            messagingSenderId: "841766177401",
            appId: "1:841766177401:web:8f41f0ddf9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let myPhone = localStorage.getItem("userPhone");
        if(myPhone) { document.getElementById('login-overlay').style.display = 'none'; loadUsers(); }
        function saveLogin() {
            const phone = document.getElementById('phoneInput').value.trim();
            if(phone.length >= 10) {
                db.collection("users").doc(phone).set({ phone: phone });
                localStorage.setItem("userPhone", phone);
                myPhone = phone;
                document.getElementById('login-overlay').style.display = 'none';
                loadUsers();
            }
        }
        function loadUsers() {
            db.collection("users").onSnapshot(snap => {
                const list = document.getElementById('user-list');
                list.innerHTML = "";
                snap.forEach(doc => {
                    const u = doc.data().phone;
                    if(u !== myPhone) {
                        list.innerHTML += `<div class="user-card" onclick="startChat('${u}')"><div class="user-avatar">${u.substring(u.length - 3)}</div><div class="text-[8px] text-gray-400">${u}</div></div>`;
                    }
                });
            });
        }
        let chatID = "";
        function startChat(friend) {
            chatID = [myPhone, friend].sort().join("_");
            document.getElementById('chatting-with').innerText = "üë§ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü: " + friend;
            loadMessages();
        }
        function sendMsg() {
            const input = document.getElementById('msgInput');
            if(!input.value.trim() || !chatID) return;
            db.collection("private_messages").add({ room: chatID, sender: myPhone, text: input.value, time: firebase.firestore.FieldValue.serverTimestamp() });
            input.value = "";
        }
        let currentSub;
        function loadMessages() {
            if(currentSub) currentSub();
            const box = document.getElementById('chat-box');
            currentSub = db.collection("private_messages").where("room", "==", chatID).orderBy("time", "asc").onSnapshot(snap => {
                box.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const isMe = d.sender === myPhone;
                    box.innerHTML += `<div class="msg ${isMe ? 'sent' : 'received'}">${d.text}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }
        document.getElementById('msgInput').addEventListener('keypress', e => { if(e.key === 'Enter') sendMsg(); });
    </script>
</body>
</html>
