‚Äç<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHURAI CHAT PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; height: 100dvh; display: flex; flex-direction: column; margin: 0; overflow: hidden; }
        .header { padding: 12px; border-bottom: 1px solid #222; display: flex; align-items: center; justify-content: space-between; background: #000; }
        .user-list-container { padding: 10px; background: #000; border-bottom: 1px solid #222; }
        .user-list { display: flex; gap: 15px; overflow-x: auto; scrollbar-width: none; padding-bottom: 5px; }
        .u-item { display: flex; flex-direction: column; align-items: center; min-width: 65px; cursor: pointer; }
        .u-img { width: 55px; height: 55px; background: #0084ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; border: 2px solid transparent; transition: 0.3s; }
        .active-user .u-img { border-color: #fff; transform: scale(1.1); }
        .online-dot { width: 12px; height: 12px; background: #31a24c; border-radius: 50%; border: 2px solid #000; position: absolute; bottom: 18px; right: 5px; }
        .chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #000; }
        .msg-wrap { display: flex; flex-direction: column; max-width: 75%; }
        .msg { padding: 10px 15px; border-radius: 18px; font-size: 14px; position: relative; }
        .sent { background: #0084ff; align-self: flex-end; border-bottom-right-radius: 4px; }
        .recv { background: #333; align-self: flex-start; border-bottom-left-radius: 4px; }
        .sender-name { font-size: 10px; color: #aaa; margin-bottom: 2px; padding: 0 5px; }
        .footer { padding: 10px; border-top: 1px solid #222; display: flex; align-items: center; gap: 12px; background: #000; }
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 12px; width: 100%; max-width: 300px; text-align: center; margin-bottom: 10px; outline: none; }
    </style>
</head>
<body>

<div id="login-screen">
    <h1 class="text-4xl font-black text-blue-500 mb-8 italic">PHURAI MAX</h1>
    <div id="step1" class="w-full flex flex-col items-center">
        <input id="phoneNum" type="tel" placeholder="+88017XXXXXXXX">
        <div id="recaptcha-container"></div>
        <button onclick="sendOTP()" class="bg-blue-600 w-full max-w-[300px] p-4 rounded-xl font-bold mt-4">‡¶ï‡ßã‡¶° ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
    </div>
    <div id="step2" class="w-full flex flex-col items-center hidden">
        <input id="otpCode" type="number" placeholder="‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®">
        <input id="userName" type="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <button onclick="verifyOTP()" class="bg-green-600 w-full max-w-[300px] p-4 rounded-xl font-bold">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<div class="header">
    <div class="flex items-center gap-2">
        <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center font-bold">P</div>
        <div><h2 id="chatTitle" class="text-sm font-bold uppercase">‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü</h2><p class="text-[9px] text-green-500 font-bold italic uppercase">Active Now</p></div>
    </div>
    <button onclick="navigator.clipboard.writeText(window.location.href); alert('‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!')" class="bg-blue-600 px-4 py-1 rounded-full text-[10px] font-bold">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶¶‡¶ø‡¶®</button>
</div>

<div class="user-list-container"><div id="uList" class="user-list"></div></div>
<div id="cBox" class="chat-box"></div>

<div class="footer">
    <span class="text-blue-500 text-2xl">‚ûï</span>
    <span class="text-blue-500 text-2xl">üì∑</span>
    <span class="text-blue-500 text-2xl">üñºÔ∏è</span>
    <span class="text-blue-500 text-2xl">üéôÔ∏è</span>
    <div class="flex-1 bg-[#242526] rounded-full px-4 py-2"><input id="mIn" type="text" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." style="background:transparent; border:none; width:100%; color:white; outline:none;"></div>
    <button onclick="sendMsg('‚û§')" class="text-blue-500 font-bold text-2xl">‚û§</button>
    <button onclick="sendMsg('üëç')" class="text-3xl">üëç</button>
</div>

<script>
    const conf = { 
        apiKey: "AIzaSyAo-AtxN0eLgtN-HznpTq2c", 
        authDomain: "phurai-3a289.firebaseapp.com", 
        projectId: "phurai-3a289", 
        storageBucket: "phurai-3a289.appspot.com", 
        messagingSenderId: "841766177401", 
        appId: "1:841766177401:web:8f41f0ddf9" 
    };
    firebase.initializeApp(conf);
    const auth = firebase.auth(); const db = firebase.firestore();
    let confirmationResult;
    let myP = localStorage.getItem("p"), myN = localStorage.getItem("n"), targetP = "group";

    if(myP && myN) { document.getElementById('login-screen').style.display='none'; startApp(); }
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });

    function sendOTP() {
        const ph = document.getElementById('phoneNum').value;
        if(!ph.startsWith('+88')) return alert("‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø +88 ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: +88017...)");
        auth.signInWithPhoneNumber(ph, window.recaptchaVerifier).then(res => {
            confirmationResult = res;
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
        }).catch(err => alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: " + err.message));
    }

    function verifyOTP() {
        const code = document.getElementById('otpCode').value; const name = document.getElementById('userName').value;
        if(!name) return alert("‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");
        confirmationResult.confirm(code).then(result => {
            localStorage.setItem("p", result.user.phoneNumber); localStorage.setItem("n", name);
            db.collection("u").doc(result.user.phoneNumber).set({n: name, p: result.user.phoneNumber, l: Date.now()});
            location.reload();
        }).catch(() => alert("‡¶≠‡ßÅ‡¶≤ ‡¶ï‡ßã‡¶°"));
    }

    function startApp() {
        setInterval(() => db.collection("u").doc(myP).update({l: Date.now()}), 10000);
        loadUsers(); loadMessages();
    }

    function loadUsers() {
        db.collection("u").onSnapshot(s => {
            const list = document.getElementById('uList');
            list.innerHTML = `<div class="u-item ${targetP=='group'?'active-user':''}" onclick="setChat('group', '‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü')"><div class="u-img">G</div><span class="text-[10px] mt-1 font-bold">‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</span></div>`;
            s.forEach(d => {
                const u = d.data(); if(u.p === myP) return;
                const isOnline = (Date.now() - u.l) < 30000;
                list.innerHTML += `<div class="u-item ${targetP==u.p?'active-user':''}" onclick="setChat('${u.p}', '${u.n}')"><div class="relative"><div class="u-img">${u.n[0]}</div>${isOnline?'<div class="online-dot"></div>':''}</div><span class="text-[10px] mt-1 font-bold">${u.n}</span></div>`;
            });
        });
    }

    function setChat(p, n) { targetP = p; document.getElementById('chatTitle').innerText = n; loadMessages(); }

    function sendMsg(t) {
        const i = document.getElementById('mIn'); const txt = t === '‚û§' ? i.value : t;
        if(txt) { db.collection("m").add({ f: myP, fn: myN, t: targetP, m: txt, ts: Date.now() }); i.value=""; }
    }

    function loadMessages() {
        db.collection("m").orderBy("ts", "asc").onSnapshot(s => {
            const b = document.getElementById('cBox'); b.innerHTML = "";
            s.forEach(d => {
                const x = d.data();
                const isForMe = (targetP === 'group' && x.t === 'group') || (x.f === myP && x.t === targetP) || (x.f === targetP && x.t === myP);
                if(isForMe) { 
                    b.innerHTML += `<div class="msg-wrap ${x.f===myP?'items-end':'items-start'}"><span class="sender-name">${x.f===myP?'‡¶Ü‡¶™‡¶®‡¶ø':x.fn}</span><div class="msg ${x.f===myP?'sent':'recv'}">${x.m}</div></div>`; 
                }
            });
            b.scrollTop = b.scrollHeight;
        });
    }
</script>
</body>
</html>
